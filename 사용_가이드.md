# ESS HMI 시스템 사용 가이드

## 📋 목차
1. [개발 모드 (테스트용)](#개발-모드)
2. [프로덕션 모드 (실제 사용)](#프로덕션-모드)
3. [실제 PLC 연결](#실제-plc-연결)

---

## 🔧 개발 모드 (테스트용)

**현재 사용 중인 방식 - 시뮬레이터로 테스트**

### 특징
- PLC 시뮬레이터 사용 (가상 데이터)
- 프론트엔드 개발 서버 (Vite) 사용
- 3개의 프로세스 실행 필요
- 코드 수정 시 자동 새로고침

### 실행 방법

```batch
START_SIMULATOR.bat (관리자 권한으로 실행)
```

### 구조
```
┌─────────────┐     ┌──────────┐     ┌────────────┐     ┌─────────┐
│ PLC 시뮬레이터 │ --> │  백엔드   │ --> │ 프론트엔드   │ --> │ 브라우저 │
│   (Python)  │     │ (FastAPI)│     │  (Vite)   │     │         │
└─────────────┘     └──────────┘     └────────────┘     └─────────┘
   포트 502           포트 8000         포트 자동         여러 탭
```

### 문제점
- ❌ 브라우저가 여러 탭으로 열림 (포트 자동 선택)
- ❌ 시작 시간이 오래 걸림 (~35초)
- ❌ 프로세스 관리가 복잡함

---

## ✅ 프로덕션 모드 (실제 사용)

**실제 운영 환경에서 사용하는 방식**

### 특징
- 프론트엔드가 백엔드에 포함됨
- 단일 프로세스 실행
- 고정된 포트 (8000)
- 브라우저 자동 실행 안정적

### 실행 방법

#### 1단계: 프로덕션 빌드 (최초 1회만)
```batch
BUILD_FOR_PRODUCTION.bat
```

이 과정은:
- 프론트엔드를 최적화된 정적 파일로 빌드
- 빌드된 파일을 `backend/static/` 폴더로 복사
- **최초 1회만 실행하면 됩니다!**

#### 2단계: 시스템 시작
```batch
START_PRODUCTION.bat (관리자 권한으로 실행)
```

### 구조
```
┌─────────────┐     ┌────────────────────────────┐     ┌─────────┐
│ PLC 시뮬레이터 │ --> │      백엔드 서버           │ --> │ 브라우저 │
│   (Python)  │     │  (FastAPI + 정적 파일)     │     │         │
└─────────────┘     └────────────────────────────┘     └─────────┘
   포트 502                  포트 8000                http://localhost:8000
```

### 장점
- ✅ **단일 URL**: `http://localhost:8000`
- ✅ **빠른 시작**: ~7초
- ✅ **안정적**: 브라우저가 정확히 1개 탭만 열림
- ✅ **간단함**: 프로세스 1개만 관리

---

## 🏭 실제 PLC 연결

**실제 하드웨어 PLC와 연결할 때**

### 설정 변경

`backend/main.py` 파일 수정:
```python
# 현재 (시뮬레이터)
plc_client = PLCClient(host="127.0.0.1", port=502, slave_id=3)

# 실제 PLC로 변경
plc_client = PLCClient(host="192.168.1.100", port=502, slave_id=3)
#                            ↑ 실제 PLC의 IP 주소
```

### 실행 방법

**시뮬레이터 없이 백엔드만 실행:**

```batch
cd backend
venv\Scripts\python.exe main.py
```

브라우저에서 `http://localhost:8000` 접속

### 구조
```
┌─────────────┐     ┌────────────────────────────┐     ┌─────────┐
│  실제 PLC   │ --> │      백엔드 서버           │ --> │ 브라우저 │
│ (하드웨어)   │     │  (FastAPI + 정적 파일)     │     │         │
└─────────────┘     └────────────────────────────┘     └─────────┘
 192.168.1.100              포트 8000                http://localhost:8000
```

---

## 🎯 권장 사용 방법

### 개발/테스트 중
```batch
START_SIMULATOR.bat
```
- 코드 수정하면서 테스트
- 여러 탭이 열리지만 작동하는 탭 사용

### 실제 사용 (데모/프레젠테이션)
```batch
# 최초 1회
BUILD_FOR_PRODUCTION.bat

# 이후 매번
START_PRODUCTION.bat
```
- 깔끔하고 빠름
- 안정적
- 전문적으로 보임

### 실제 PLC 연결
1. `backend/main.py`에서 PLC IP 수정
2. 프로덕션 빌드 (최초 1회)
3. 백엔드만 실행

---

## ❓ 자주 묻는 질문

### Q: 왜 개발 모드는 복잡한가요?
**A:** 개발 모드는 코드 수정 시 자동 새로고침을 위해 Vite 개발 서버를 사용합니다. 
Vite는 포트가 사용 중이면 자동으로 다른 포트를 선택하기 때문에 여러 탭이 열립니다.

### Q: 프로덕션 빌드는 언제 다시 해야 하나요?
**A:** 프론트엔드 코드를 수정했을 때만 다시 빌드하면 됩니다.
백엔드(Python) 코드만 수정했다면 빌드 불필요합니다.

### Q: 실제 현장에서는 어떻게 사용하나요?
**A:** 
1. 프로덕션 빌드 1회 실행
2. PLC IP 주소 설정
3. 백엔드만 실행
4. 브라우저로 접속
5. 끝!

매우 간단합니다. 개발 모드가 복잡한 것뿐입니다.

---

## 📞 문제 해결

### 브라우저가 안 열려요
- Chrome이 설치되어 있는지 확인
- 수동으로 `http://localhost:8000` 접속

### 데이터가 0으로 나와요
- PLC 시뮬레이터가 실행 중인지 확인
- "PLC 시뮬레이터" 창에서 데이터가 업데이트되는지 확인
- 백엔드 로그에서 연결 오류 확인

### 포트가 이미 사용 중이래요
```batch
# 모든 프로세스 종료
taskkill /F /IM python.exe /T
taskkill /F /IM node.exe /T
```

---

## 🎉 결론

**실제 사용할 때는 매우 간단합니다!**

```
프로덕션 빌드 (최초 1회) → START_PRODUCTION.bat → 끝!
```

개발 모드가 복잡한 이유는 개발 편의성을 위한 것이고,
실제 운영 환경에서는 훨씬 간단하고 안정적입니다.


